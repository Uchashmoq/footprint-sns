// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  //output   = "../lib/generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id                String    @id
  username          String    @unique
  avatar            String?
  cover             String?
  description       String?
  location          String?
  camera            String?
  website           String?
  createdAt         DateTime  @default(now())
  photos            Photo[]
  albums            Album[]
  posts             Post[]
  // 反向关系（可选）
  commentsAuthored  Comment[] @relation("AuthorOfComment")
  commentsMentioned Comment[] @relation("MentionedInComment")

  followers    Follower[]    @relation("UserFollowers")
  followings   Follower[]    @relation("UserFollowings")
  likes        Like[]
  commentLikes CommentLike[]
}

model Comment {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  user   User   @relation("AuthorOfComment", fields: [userId], references: [id], onDelete: Cascade)
  userId String

  photo   Photo @relation(fields: [photoId], references: [id], onDelete: Cascade)
  photoId Int

  mentioned       User   @relation("MentionedInComment", fields: [mentionedUserId], references: [id], onDelete: Cascade)
  mentionedUserId String

  commentLike CommentLike[]
}

model CommentLike {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String

  comment   Comment @relation(fields: [commentId], references: [id], onDelete: Cascade)
  commentId Int
}

model Like {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String

  photo   Photo @relation(fields: [photoId], references: [id], onDelete: Cascade)
  photoId Int
}

model Follower {
  id          Int      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  follower    User     @relation("UserFollowers", fields: [followerId], references: [id], onDelete: Cascade)
  followerId  String
  following   User     @relation("UserFollowings", fields: [followingId], references: [id], onDelete: Cascade)
  followingId String
}

model Photo {
  id         Int      @id @default(autoincrement())
  name       String
  desc       String?
  uploadedAt DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String

  width                Int
  height               Int
  camera               String?
  lens                 String?
  focalLength          String?
  aperture             String?
  shutterTime          String?
  iso                  String?
  exposureCompensation String?
  longitude            String?
  latitude             String?

  albumn  Album? @relation(fields: [albumId], references: [id], onDelete: NoAction)
  albumId Int

  post   Post @relation(fields: [postId], references: [id], onDelete: Cascade)
  postId Int

  likes    Like[]
  comments Comment[]
}

model Album {
  id        Int      @id @default(autoincrement())
  name      String
  desc      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  photos    Photo[]

  posts Post[]
}

model Post {
  id         Int      @id @default(autoincrement())
  uploadedAt DateTime @default(now())

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String

  photos Photo[]

  updatedAlbum Album @relation(fields: [AlbumId], references: [id], onDelete: NoAction)
  AlbumId      Int
}
